75. 자동차 대여 기록 별 대여 금액 구하기

https://school.programmers.co.kr/learn/courses/30/lessons/151141

WITH ONE_THREE AS (
    SELECT CAR_ID, C.CAR_TYPE, DAILY_FEE, DISCOUNT_RATE, SUBSTRING_INDEX(DURATION_TYPE, '일', 1) DURATION_TYPE
    FROM CAR_RENTAL_COMPANY_CAR C LEFT JOIN CAR_RENTAL_COMPANY_DISCOUNT_PLAN P ON C.CAR_TYPE=P.CAR_TYPE
    WHERE C.CAR_TYPE='트럭'
)
SELECT 
    HISTORY_ID, 
    MIN(IF((DATEDIFF(END_DATE, START_DATE)+1)>=DURATION_TYPE, 
           ROUND(DAILY_FEE*(1-(DISCOUNT_RATE/100)))*(DATEDIFF(END_DATE, START_DATE)+1), 
           DAILY_FEE*(DATEDIFF(END_DATE, START_DATE)+1))) FEE
FROM CAR_RENTAL_COMPANY_RENTAL_HISTORY H INNER JOIN ONE_THREE O ON H.CAR_ID=O.CAR_ID
GROUP BY 1
ORDER BY 2 DESC, 1 DESC
